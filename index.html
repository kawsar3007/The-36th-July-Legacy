<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>THE 36th JULY LEGACY | OFFICIAL</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        /* Million Dollar Homepage Style Tooltip */
        #legacy-tooltip { 
            position: absolute; display: none; background: #FFFFE1; color: #000; 
            padding: 3px 8px; border: 1px solid #333; z-index: 10000; 
            pointer-events: none; font-size: 13px; font-family: Tahoma, sans-serif;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }
        /* ক্যানভাস লম্বা (Vertical) হবে, ডানে-বামে ফ্লাইট করবে না */
        .map-container { 
            width: 1000px; margin: 20px auto; overflow-x: hidden; 
            border: 2px solid #333; background: #fff; position: relative;
        }
        #mainCanvas { display: block; }
    </style>
</head>
<body>

<div id="legacy-tooltip"></div>

<div class="top-nav">
    <div style="display:flex; gap:10px;">
        <input type="number" id="phSearch" style="padding:10px; background:#1E2329; color:#fff; border:1px solid #444;" placeholder="Search Phone Number">
        <button onclick="searchByPhone()" style="background:#FCD535; color:#000; border:none; padding:10px 20px; cursor:pointer; font-weight:bold;">SEARCH</button>
    </div>
    <div class="pill">PAYMENT: 01756206213 (BKASH/NAGAD)</div>
</div>

<div class="hero">
    <h1 class="shimmer-title">THE 36th JULY LEGACY</h1>
    <p style="color: #FCD535; font-weight: bold;">"BE A PART OF BANGLADESH'S HISTORY FOR ONLY ৳36"</p>
    <div class="actions">
        <a href="order.html" class="cta-gold">RESERVE MY PLOT</a>
        <button onclick="downloadMap()" class="cta-outline">DOWNLOAD MAP</button>
    </div>
</div>

<div class="map-container">
    <canvas id="mainCanvas"></canvas>
</div>

<a href="support.html" style="position:fixed; bottom:30px; right:30px; z-index:9999;">
    <img src="https://cdn-icons-png.flaticon.com/512/3703/3703377.png" width="60" title="Customer Support">
</a>

<footer style="background: #0B0E11; color: #848e9c; padding: 40px; font-size: 13px; border-top: 1px solid #333; text-align: center;">
    <p style="color: #FCD535; font-weight: bold; margin-bottom: 10px;">THE 36th JULY LEGACY © 2026 KAWSAR AHMED. All rights reserved.</p>
    <p>I am not responsible for the content of external sites. Images featured on homepage are © of their respective owners.</p>
</footer>

<script>
    const firebaseConfig = { 
        apiKey: "AIzaSyCAdnfu2R82xbC7H85n_9mvQBE58X3TjbA",
        databaseURL: "https://the-5k-elite-legacy-default-rtdb.firebaseio.com" 
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const cv = document.getElementById('mainCanvas'), ctx = cv.getContext('2d');
    const bSize = 50, cols = 20; // ১০০০ পিক্সেল চওড়া ম্যাপে ২০টি ঘর হবে
    cv.width = 1000; 
    cv.height = 3200 * bSize; // লম্বা ক্যানভাস

    let pixels = {};
    const imgCache = {};

    db.ref('pixels').on('value', s => {
        pixels = s.val() || {};
        ctx.fillStyle = "#ffffff"; ctx.fillRect(0,0,cv.width,cv.height);
        Object.values(pixels).forEach(p => {
            const id = parseInt(p.plotID)-1, x = (id%cols)*bSize, y = Math.floor(id/cols)*bSize;
            if(!imgCache[p.imageUrl]) {
                const img = new Image(); img.crossOrigin="anonymous"; img.src=p.imageUrl;
                img.onload = () => { imgCache[p.imageUrl] = img; ctx.drawImage(img, x, y, bSize, bSize); };
            } else {
                ctx.drawImage(imgCache[p.imageUrl], x, y, bSize, bSize);
            }
        });
    });

    // Million Dollar Homepage Hover Logic
    cv.addEventListener('mousemove', (e) => {
        const rect = cv.getBoundingClientRect();
        const mouseX = (e.clientX - rect.left) * (cv.width / rect.width);
        const mouseY = (e.clientY - rect.top) * (cv.height / rect.height);
        
        let found = false;
        Object.values(pixels).forEach(p => {
            const id = parseInt(p.plotID)-1, px = (id%cols)*bSize, py = Math.floor(id/cols)*bSize;
            if(mouseX >= px && mouseX <= px+bSize && mouseY >= py && mouseY <= py+bSize) {
                const tt = document.getElementById('legacy-tooltip');
                tt.style.display = 'block';
                tt.style.left = (e.pageX + 15) + 'px';
                tt.style.top = (e.pageY + 15) + 'px';
                tt.innerText = p.name; // শুধুমাত্র নাম দেখাবে
                cv.style.cursor = 'pointer';
                found = true;
            }
        });
        if(!found) { document.getElementById('legacy-tooltip').style.display = 'none'; cv.style.cursor = 'default'; }
    });

    // ক্লিক লজিক
    cv.addEventListener('click', (e) => {
        const rect = cv.getBoundingClientRect();
        const canvasX = (e.clientX - rect.left) * (cv.width / rect.width);
        const canvasY = (e.clientY - rect.top) * (cv.height / rect.height);
        Object.values(pixels).forEach(p => {
            const id = parseInt(p.plotID)-1, px = (id%cols)*bSize, py = Math.floor(id/cols)*bSize;
            if(canvasX >= px && canvasX <= px+bSize && canvasY >= py && canvasY <= py+bSize) {
                if(p.link && p.link !== "#") window.open(p.link, '_blank');
            }
        });
    });

    function searchByPhone() {
        const ph = document.getElementById('phSearch').value;
        const found = Object.values(pixels).find(p => p.phone === ph);
        if(found) {
            const id = found.plotID-1, y = Math.floor(id/cols)*bSize;
            window.scrollTo({top: y + cv.offsetTop - 100, behavior:'smooth'});
            alert("Found " + found.name + " at Plot #" + found.plotID);
        } else { alert("Not Found!"); }
    }

    function downloadMap() {
        const link = document.createElement('a');
        link.download = 'july-legacy.png';
        link.href = cv.toDataURL("image/png");
        link.click();
    }
</script>
</body>
</html>
